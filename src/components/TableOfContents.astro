---
import type { MarkdownHeading } from 'astro';

interface Props {
  headings: MarkdownHeading[];
}

const { headings } = Astro.props;

const toc = headings.filter((h) => h.depth > 1 && h.depth <= 3);
---

{toc.length > 0 && (
  <nav class="toc-container text-sm">
    <div class="mb-4 font-semibold text-slate-900 tracking-wide">On this page</div>
    <ul class="flex flex-col space-y-2.5">
      {toc.map((heading) => (
        <li class={`toc-item pl-${(heading.depth - 2) * 4}`}>
          <a
            href={`#${heading.slug}`}
            class="block text-slate-500 hover:text-slate-900 transition-colors duration-200"
            data-toc-link
          >
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        const id = entry.target.getAttribute('id');
        const link = document.querySelector(`a[href="#${id}"]`);
        
        if (entry.isIntersecting) {
          document.querySelectorAll('a[data-toc-link]').forEach((l) => {
            l.classList.remove('text-blue-600', 'font-medium');
            l.classList.add('text-slate-500');
          });
          link?.classList.remove('text-slate-500');
          link?.classList.add('text-blue-600', 'font-medium');
        }
      });
    },
    { rootMargin: '-100px 0px -66% 0px' }
  );

  document.querySelectorAll('h2[id], h3[id]').forEach((section) => {
    observer.observe(section);
  });
</script>