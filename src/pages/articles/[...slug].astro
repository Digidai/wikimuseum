---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleNav from '../../components/ArticleNav.astro';

export async function getStaticPaths() {
  const articles = await getCollection('articles');
  const sortedArticles = articles.sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
  );

  return sortedArticles.map((article, index) => ({
    params: { slug: article.id },
    props: {
      article,
      prev: sortedArticles[index + 1] || null,
      next: sortedArticles[index - 1] || null
    }
  }));
}

const { article, prev, next } = Astro.props;
const { Content } = await render(article);

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
};
---

<BaseLayout
  title={article.data.title}
  description={article.data.description}
  keywords={article.data.keywords}
>
  <div class="max-w-3xl mx-auto">
    <article>
      <header class="pb-8 border-b border-notion-border">
        <time class="text-sm text-notion-tertiary">
          {formatDate(article.data.publishDate)}
        </time>
        <h1 class="text-3xl font-bold mt-2 text-notion-text leading-tight">
          {article.data.title}
        </h1>
        {article.data.keywords && article.data.keywords.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-4">
            {article.data.keywords.map((keyword: string) => (
              <span class="px-3 py-1 bg-notion-hover text-notion-secondary text-sm rounded-full">
                {keyword}
              </span>
            ))}
          </div>
        )}
      </header>

      <div class="prose py-8">
        <Content />
      </div>
    </article>

    <ArticleNav prev={prev} next={next} />
  </div>
</BaseLayout>
